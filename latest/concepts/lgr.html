<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Local grid refinement &mdash; modflow-setup 0.5.0.post27+gc10c32d documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=126a16d0"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Specifying perimeter boundary conditions from another model" href="perimeter-bcs.html" />
    <link rel="prev" title="Interpolating data to the model grid" href="interp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            modflow-setup
          </a>
              <div class="version">
                0.5.0.post27+gc10c32d
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../philosophy.html">     Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html"> Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10min.html"> 10 Minutes to Modflow-setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html"> Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config-file-gallery.html"> Configuration File Gallery</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../structure.html"> Basic program structure and usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config-file.html"> The configuration file</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html"> Concepts and methods</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="interp.html">Interpolation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Local grid refinement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#specification-of-vertical-refinement">Specification of vertical refinement</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="perimeter-bcs.html">     Specifying perimeter boundary conditions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html"> Input instructions by package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html"> Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html"> Code reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config-file-defaults.html"> Configuration file defaults</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-history.html"> Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html"> Contributing to modflow-setup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bibliography</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#modflow-setup-applications">Modflow-setup applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#workflow-examples">Workflow examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">modflow-setup</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Modflow-setup concepts and methods</a></li>
      <li class="breadcrumb-item active">Local grid refinement</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/concepts/lgr.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="local-grid-refinement">
<h1>Local grid refinement<a class="headerlink" href="#local-grid-refinement" title="Link to this heading">¶</a></h1>
<p>In MODFLOW 6, two groundwater models can be tightly coupled in the same simulation, which allows for efficient “local grid refinement” (LGR; Mehl and others, 2006) and “semistructured” (Feinstein and others, 2016) configurations that combine multiple structured model layers at different resolutions (Langevin and others, 2017). Locally refined areas are conceptualized as separate “child” models that are linked to the surrounding (usually coarser) “parent” model through the GWF Model Exchange (GWFGWF) Package. Similarly, “semistructured” configurations are represented by multiple linked models for each layer or group of layers with the same resolution.</p>
<p>Modflow-setup supports local grid refinment via an <code class="docutils literal notranslate"><span class="pre">lgr:</span></code> subblock within the <code class="docutils literal notranslate"><span class="pre">setup_grid:</span></code> block of the configuration file. The <code class="docutils literal notranslate"><span class="pre">lgr:</span></code> subblock consists of one of more subblocks, each keyed by a linked model name and containing configuration input for that linked model. Vertical layer refinement relative to the “parent” model is also specified for each layer of the parent model.</p>
<p>For example, the following “parent” configuration for the <a class="reference internal" href="../config-file-gallery.html#pleasant-lake-test-case"><span class="std std-ref">Pleasant Lake Example</span></a> creates a local refinement model named “<code class="docutils literal notranslate"><span class="pre">pleasant_lgr_inset</span></code>” that spans all layers of the parent model, at the same vertical resolution (1 inset model layer per parent model layer).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">lgr</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pleasant_lgr_inset</span><span class="p">:</span>
<span class="w">      </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;pleasant_lgr_inset.yml&#39;</span>
<span class="w">      </span><span class="c1"># number of inset layers for each parent layer</span>
<span class="w">      </span><span class="c1"># this can be an integer (vertically uniform refinement)</span>
<span class="w">      </span><span class="c1"># a list (with an entry for each parent layer)</span>
<span class="w">      </span><span class="c1"># or a dictionary (with entries for each parent layer that is refined;</span>
<span class="w">      </span><span class="c1"># unlisted layers will default to zero)</span>
<span class="w">      </span><span class="nt">layer_refinement</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># number of lgr model layers per parent model layer</span>
</pre></div>
</div>
<p>The horizontal location and resolution of the inset model are specified in the <a class="reference internal" href="../config-file-gallery.html#pleasant-lgr-inset-yml"><span class="std std-ref">inset model configuration file</span></a>, in the same way that they are specified for any model. In this example, the parent model has a uniform horizontal resolution of 200 meters, and the inset a uniform resolution of 40 meters (a horizontal refinement of 5 inset model cells per parent model cells). The inset model resolution must be a factor of the parent model resolution.</p>
<a class="reference internal image-reference" href="../_images/pleasant_lgr.png"><img alt="Example of LGR refinement in all layers." src="../_images/pleasant_lgr.png" style="width: 1200px;" /></a>
<a class="reference internal image-reference" href="../_images/pleasant_lgr_xsection.png"><img alt="Example of LGR refinement in all layers." src="../_images/pleasant_lgr_xsection.png" style="width: 1200px;" /></a>
<p>Input from the <code class="docutils literal notranslate"><span class="pre">lgr:</span></code> subblock and the inset model configuration file(s) is passed to the <a class="reference external" href="https://flopy.readthedocs.io/en/latest/source/flopy.utils.lgrutil.html#flopy.utils.lgrutil.Lgr" title="(in FloPy v3.9.0.dev1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flopy</span> <span class="pre">Lgr</span> <span class="pre">Utility</span></code></a>, which helps create input for the GWF Model Exchange Package.</p>
<p>Within the context of a Python session, inset model information is stored in a dictionary under an <code class="docutils literal notranslate"><span class="pre">inset</span></code> attribute attached to the parent model. For example, to access a Flopy model object for the above inset model from a parent model named <code class="docutils literal notranslate"><span class="pre">model</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">inset_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inset</span><span class="p">[</span><span class="s1">&#39;pleasant_lgr_inset&#39;</span><span class="p">]</span>
</pre></div>
</div>
<section id="specification-of-vertical-refinement">
<h2>Specification of vertical refinement<a class="headerlink" href="#specification-of-vertical-refinement" title="Link to this heading">¶</a></h2>
<p>Vertical refinement in the LGR child grid is specified in the <code class="docutils literal notranslate"><span class="pre">layer_refinement:</span></code> item, as the number of child layers in each parent model layer. Currently vertical refinement is limited to even subdivision of parent model layers. Vertical refinement can be specified as an integer for uniform refinement across all parent model layers:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">layer_refinement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
<p>a list with an entry for each parent layer:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">layer_refinement</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>or a dictionary with entries for each parent layer that is refined:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">layer_refinement</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">0:1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">1:1</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">2:1</span>
</pre></div>
</div>
<p>Parent model layers with 0 specified refinement are excluded from the child model. The list and dictionary inputs above are equivalent, as unlisted layers in the dictionary are assigned default refinement values of 0. Refinement values &gt; 1 result in even subdivision of the parent layers. Similar to one-way coupled inset models, LGR child model layers surfaces can be discretized at the finer child resolution from the original source data. In the example below, a 9-layer child model is set within the top 4 layers of a 5 layer parent model. The parent model <code class="docutils literal notranslate"><span class="pre">lgr:</span></code> configuration block is specified as:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">lgr</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pleasant_lgr_inset</span><span class="p">:</span>
<span class="w">      </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;pleasant_vertical_lgr_inset.yml&#39;</span>
<span class="w">      </span><span class="c1"># number of inset layers for each parent layer</span>
<span class="w">      </span><span class="c1"># this can be an integer (vertically uniform refinement)</span>
<span class="w">      </span><span class="c1"># a list (with an entry for each parent layer)</span>
<span class="w">      </span><span class="c1"># or a dictionary (with entries for each parent layer that is refined;</span>
<span class="w">      </span><span class="c1"># unlisted layers will default to zero)</span>
<span class="w">      </span><span class="nt">layer_refinement</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>In the child model <code class="docutils literal notranslate"><span class="pre">dis:</span></code> configuration block, raster surfaces that were used to define the parent model layer bottoms are specified at their respective desired locations within the child model grid; Modflow-setup then subdivides these to create the desired layer configuration. The layer specification in the child model <code class="docutils literal notranslate"><span class="pre">dis:</span></code> block must be consistent with the <cite>layer_refinement:</cite> input in the parent model configuration (see below). The image below shows</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dis</span><span class="p">:</span>
<span class="w">  </span><span class="nt">options</span><span class="p">:</span>
<span class="w">    </span><span class="nt">length_units</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;meters&#39;</span>
<span class="w">  </span><span class="nt">dimensions</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># nrow and ncol are based on the buffer distance and grid spacing</span>
<span class="w">    </span><span class="nt">nlay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9</span>
<span class="w">  </span><span class="nt">source_data</span><span class="p">:</span>
<span class="w">    </span><span class="nt">top</span><span class="p">:</span>
<span class="w">      </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;../../../examples/data/pleasant/source_data/rasters/dem40m.tif&#39;</span><span class="w"> </span><span class="c1"># DEM file; path relative to setup script</span>
<span class="w">      </span><span class="nt">elevation_units</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;meters&#39;</span>
<span class="w">    </span><span class="nt">botm</span><span class="p">:</span>
<span class="w">      </span><span class="nt">filenames</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># bottom of layer 0 set halfway between layer 1 bottom and model top (layer_refinement[0] == 2)</span>
<span class="w">        </span><span class="nt">1</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;../../../examples/data/pleasant/source_data/rasters/botm0.tif&#39;</span><span class="w">  </span><span class="c1"># preprocessed surface for parent model layer 0 bottom</span>
<span class="w">        </span><span class="c1"># bottom of layer 2 set halfway between layers 1 and 3 (layer_refinement[1] == 2)</span>
<span class="w">        </span><span class="nt">3</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;../../../examples/data/pleasant/source_data/rasters/botm1.tif&#39;</span><span class="w">  </span><span class="c1"># preprocessed surface for parent model layer 1 bottom</span>
<span class="w">        </span><span class="c1"># bottom of layer 4 set halfway between layers 3 and 5 (layer_refinement[2] == 2)</span>
<span class="w">        </span><span class="nt">5</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;../../../examples/data/pleasant/source_data/rasters/botm2.tif&#39;</span><span class="w">  </span><span class="c1"># preprocessed surface for parent model layer 2 bottom</span>
<span class="w">        </span><span class="c1"># bottoms of layers 6 and 7 equally subdivide layers 5 and 8 (layer_refinement[3] == 3)</span>
<span class="w">        </span><span class="c1"># bottom of layer 8 set from parent model layer 3 bottom</span>
</pre></div>
</div>
<p>The figure below shows a cross section through the model grid resulting from this configuration:</p>
<a class="reference internal image-reference" href="../_images/pleasant_vlgr_xsection.png"><img alt="Example of partial vertical LGR refinement with layer subdivision." src="../_images/pleasant_vlgr_xsection.png" style="width: 1500px;" /></a>
<p><strong>A few notes about LGR functionality in Modflow-setup</strong></p>
<ul class="simple">
<li><p><strong>Locally refined “inset” models must be aligned with the parent model grid</strong>, which also means that their horizontal resolution must be a factor of the “parent” model resolution. Modflow-setup handles the alignment automatically by “snapping” inset model grids to the lower left corner of the parent cell containing the lower left corner of the inset model grid (the inset model origin in real-world coordinates).</p></li>
<li><p>Similarly, inset models need to align vertically with the parent model layers. Parent layers can be subdivided using values &gt; 1 in the <code class="docutils literal notranslate"><span class="pre">layer_refinement:</span></code> input option.</p></li>
<li><p>Specifically, <strong>the layer specification in the child model</strong> <code class="docutils literal notranslate"><span class="pre">dis:</span></code> <strong>block must be consistent with the</strong> <code class="docutils literal notranslate"><span class="pre">layer_refinement:</span></code> <strong>input in the parent model configuration</strong>. For example, if a <code class="docutils literal notranslate"><span class="pre">layer_refinement</span></code> of <code class="docutils literal notranslate"><span class="pre">3</span></code> is specified for the last parent layer included in the child model domain, then the last two raster surfaces specified in the child model <code class="docutils literal notranslate"><span class="pre">dis</span></code>: block must be specified with two layer bottoms in between. Similarly, the values in <code class="docutils literal notranslate"><span class="pre">layer_refinement:</span></code> in the parent model configuration must sum to <code class="docutils literal notranslate"><span class="pre">nlay:</span></code> specified in the child model <code class="docutils literal notranslate"><span class="pre">dis:</span></code> configuration block.</p></li>
<li><p>Regardless of the supplied input, the child model bottom and parent model tops are aligned to remove any vertical gaps or overlap in the numerical model grid. If a raster surface is supplied for the child model bottom, the child bottom/parent top surface is based on the mean bottom elevations sampled to the child cells within each parent cell area.</p></li>
<li><p>Child model <code class="docutils literal notranslate"><span class="pre">layer_refinement:</span></code> must start at the top of the parent model, and include a contiguous sequence of parent model layers.</p></li>
<li><p>Multiple inset models at different horizontal locations, and even inset models within inset models should be achievable, but have not been tested.</p></li>
<li><p><strong>Multi-model configurations come with costs.</strong> Each model within a MODFLOW 6 simulation carries its own set of files, including external text array and list input files to packages. As with a single model, when using the automated parameterization functionality in <a class="reference external" href="https://github.com/pypest/pyemu">pyEMU</a>, the number of files is multiplied. At some point, at may be more efficient to work with individual models, and design the grids in such a way that boundary conditions along the model perimeters have a minimal impact on the predictions of interest.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="interp.html" class="btn btn-neutral float-left" title="Interpolating data to the model grid" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="perimeter-bcs.html" class="btn btn-neutral float-right" title="Specifying perimeter boundary conditions from another model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2024, Modflow-setup developers |.
      <span class="lastupdated">Last updated on Sep 09, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>