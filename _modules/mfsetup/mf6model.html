

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mfsetup.mf6model &mdash; modflow-setup 0.6.0.post76+g769cd59 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=6359e75d"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            modflow-setup
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../philosophy.html">     Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html"> Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../10min.html"> 10 Minutes to Modflow-setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html"> Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config-file-gallery.html"> Configuration File Gallery</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../structure.html"> Basic program structure and usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config-file.html"> The configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/index.html"> Concepts and methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html"> Input instructions by package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html"> Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html"> Code reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config-file-defaults.html"> Configuration file defaults</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-history.html"> Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html"> Contributing to modflow-setup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bibliography</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html#modflow-setup-applications">Modflow-setup applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html#workflow-examples">Workflow examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">modflow-setup</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">mfsetup.mf6model</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mfsetup.mf6model</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">flopy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">fm</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modflow</span>
<span class="n">mf6</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">mf6</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flopy.utils.lgrutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lgr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gisutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_values_at_points</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.bcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">remove_inactive_bcs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.discretization</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ModflowGwfdis</span><span class="p">,</span>
    <span class="n">create_vertical_pass_through_cells</span><span class="p">,</span>
    <span class="n">deactivate_idomain_above</span><span class="p">,</span>
    <span class="n">find_remove_isolated_cells</span><span class="p">,</span>
    <span class="n">make_idomain</span><span class="p">,</span>
    <span class="n">make_irch</span><span class="p">,</span>
    <span class="n">make_lgr_idomain</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.fileio</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_version_to_fileheader</span><span class="p">,</span> <span class="n">flopy_mfsimulation_load</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.fileio</span><span class="w"> </span><span class="kn">import</span> <span class="n">load</span> <span class="k">as</span> <span class="n">load_config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.fileio</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_cfg</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.ic</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_strt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.lakes</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_lakeperioddata</span><span class="p">,</span>
    <span class="n">setup_lake_connectiondata</span><span class="p">,</span>
    <span class="n">setup_lake_fluxes</span><span class="p">,</span>
    <span class="n">setup_lake_info</span><span class="p">,</span>
    <span class="n">setup_lake_tablefiles</span><span class="p">,</span>
    <span class="n">setup_mf6_lake_obs</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.mfmodel</span><span class="w"> </span><span class="kn">import</span> <span class="n">MFsetupMixin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.mover</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_mover_sfr_package_input</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.obs</span><span class="w"> </span><span class="kn">import</span> <span class="n">remove_inactive_obs</span><span class="p">,</span> <span class="n">setup_head_observations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.oc</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_oc_period_input</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.tdis</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_date_comments_to_tdis</span><span class="p">,</span> <span class="n">setup_perioddata</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_time_units</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mfsetup.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">flatten</span><span class="p">,</span> <span class="n">get_input_arguments</span>


<div class="viewcode-block" id="MF6model">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MF6model</span><span class="p">(</span><span class="n">MFsetupMixin</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwf</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing a MODFLOW-6 model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_file</span> <span class="o">=</span> <span class="s1">&#39;mf6_defaults.yml&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modelname</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">exe_name</span><span class="o">=</span><span class="s1">&#39;mf6&#39;</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">version</span><span class="o">=</span><span class="s1">&#39;mf6&#39;</span><span class="p">,</span> <span class="n">lgr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;simulation&#39;</span><span class="p">:</span> <span class="n">simulation</span><span class="p">,</span>
                    <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="n">parent</span><span class="p">,</span>
                    <span class="s1">&#39;modelname&#39;</span><span class="p">:</span> <span class="n">modelname</span><span class="p">,</span>
                    <span class="s1">&#39;exe_name&#39;</span><span class="p">:</span> <span class="n">exe_name</span><span class="p">,</span>
                    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
                    <span class="s1">&#39;lgr&#39;</span><span class="p">:</span> <span class="n">lgr</span><span class="p">}</span>
        <span class="c1"># load configuration, if supplied</span>
        <span class="k">if</span> <span class="n">cfg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_cfg</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_model_kwargs</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
            <span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">])</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">}</span>
        <span class="c1"># otherwise, pass arguments on to flopy constructor</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">defaults</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwf</span><span class="p">,</span>
                                     <span class="n">exclude</span><span class="o">=</span><span class="s1">&#39;packages&#39;</span><span class="p">)</span>
        <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwf</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1">#mf6.ModflowGwf.__init__(self, simulation,</span>
        <span class="c1">#                        modelname, exe_name=exe_name, version=version,</span>
        <span class="c1">#                        **kwargs)</span>
        <span class="n">MFsetupMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_lgr</span> <span class="o">=</span> <span class="n">lgr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_package_setup_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">,</span> <span class="s1">&#39;dis&#39;</span><span class="p">,</span> <span class="s1">&#39;ic&#39;</span><span class="p">,</span> <span class="s1">&#39;npf&#39;</span><span class="p">,</span> <span class="s1">&#39;sto&#39;</span><span class="p">,</span> <span class="s1">&#39;rch&#39;</span><span class="p">,</span> <span class="s1">&#39;oc&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;chd&#39;</span><span class="p">,</span> <span class="s1">&#39;drn&#39;</span><span class="p">,</span> <span class="s1">&#39;ghb&#39;</span><span class="p">,</span> <span class="s1">&#39;sfr&#39;</span><span class="p">,</span> <span class="s1">&#39;lak&#39;</span><span class="p">,</span> <span class="s1">&#39;riv&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;wel&#39;</span><span class="p">,</span> <span class="s1">&#39;maw&#39;</span><span class="p">,</span> <span class="s1">&#39;obs&#39;</span><span class="p">]</span>
        <span class="c1"># set up the model configuration dictionary</span>
        <span class="c1"># start with the defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_path</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_file</span><span class="p">)</span> <span class="c1">#&#39;mf6_defaults.yml&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relative_external_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;relative_external_paths&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># set the model workspace and change working directory to there</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_ws</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">)</span>
        <span class="c1"># update defaults with user-specified config. (loaded above)</span>
        <span class="c1"># set up and validate the model configuration dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span> <span class="o">=</span> <span class="n">load</span>  <span class="c1"># whether the model is being created or loaded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_cfg</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

        <span class="c1"># property attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idomain</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># other attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_features</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># dictionary for caching shapefile datasets in memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drop_thin_cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dis&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;drop_thin_cells&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># arrays remade during this session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updated_arrays</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># delete the temporary &#39;original-files&#39; folder</span>
        <span class="c1"># if it already exists, to avoid side effects from stale files</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_lgr</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MFsetupMixin</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MFsetupMixin</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nlay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nlay&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">length_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">][</span><span class="s1">&#39;length_units&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">time_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">][</span><span class="s1">&#39;time_units&#39;</span><span class="p">]</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">perioddata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;DataFrame summarizing stress period information.</span>
<span class="sd">        Columns:</span>
<span class="sd">        ============== =========================================</span>
<span class="sd">        start_datetime Start date of each model stress period</span>
<span class="sd">        end_datetime   End date of each model stress period</span>
<span class="sd">        time           MODFLOW elapsed time, in days*</span>
<span class="sd">        per            Model stress period number</span>
<span class="sd">        perlen         Stress period length (days)</span>
<span class="sd">        nstp           Number of timesteps in stress period</span>
<span class="sd">        tsmult         Timestep multiplier</span>
<span class="sd">        steady         Steady-state or transient</span>
<span class="sd">        oc             Output control setting for MODFLOW</span>
<span class="sd">        parent_sp      Corresponding parent model stress period</span>
<span class="sd">        ============== =========================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perioddata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check first for already loaded time discretization info</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tdis_perioddata_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modeltime</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
                                          <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;perlen&#39;</span><span class="p">,</span> <span class="s1">&#39;nstp&#39;</span><span class="p">,</span> <span class="s1">&#39;tsmult&#39;</span><span class="p">]}</span>
                <span class="n">nper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modeltime</span><span class="o">.</span><span class="n">nper</span>
                <span class="n">steady</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modeltime</span><span class="o">.</span><span class="n">steady_state</span>
                <span class="n">default_start_datetime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modeltime</span><span class="o">.</span><span class="n">start_datetime</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tdis_perioddata_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">][</span><span class="s1">&#39;perioddata&#39;</span><span class="p">]</span>
                <span class="n">default_start_datetime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start_date_time&#39;</span><span class="p">,</span>
                                                                         <span class="s1">&#39;1970-01-01&#39;</span><span class="p">)</span>
                <span class="c1">#tdis_dimensions_config = self.cfg[&#39;tdis&#39;][&#39;dimensions&#39;]</span>
                <span class="n">nper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">][</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nper&#39;</span><span class="p">)</span>
                <span class="c1"># steady can be input in either the tdis or sto input blocks</span>
                <span class="n">steady</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;steady&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">steady</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">steady</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;sto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;steady&#39;</span><span class="p">)</span>

            <span class="n">parent_stress_periods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copy_stress_periods&#39;</span><span class="p">)</span>
            <span class="n">perioddata</span> <span class="o">=</span> <span class="n">setup_perioddata</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="n">tdis_perioddata_config</span><span class="o">=</span><span class="n">tdis_perioddata_config</span><span class="p">,</span>
                    <span class="n">default_start_datetime</span><span class="o">=</span><span class="n">default_start_datetime</span><span class="p">,</span>
                    <span class="n">nper</span><span class="o">=</span><span class="n">nper</span><span class="p">,</span> <span class="n">steady</span><span class="o">=</span><span class="n">steady</span><span class="p">,</span>
                    <span class="n">time_units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_units</span><span class="p">,</span>
                    <span class="n">parent_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                    <span class="n">parent_stress_periods</span><span class="o">=</span><span class="n">parent_stress_periods</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_perioddata</span> <span class="o">=</span> <span class="n">perioddata</span>
            <span class="c1"># reset nper property so that it will reference perioddata table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nper</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_perioddata</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables_path</span><span class="si">}</span><span class="s1">/stress_period_data.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># update the model configuration</span>
            <span class="k">if</span> <span class="s1">&#39;parent_sp&#39;</span> <span class="ow">in</span> <span class="n">perioddata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">][</span><span class="s1">&#39;copy_stress_periods&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">perioddata</span><span class="p">[</span><span class="s1">&#39;parent_sp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perioddata</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">idomain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;3D array indicating which cells will be included in the simulation.</span>
<span class="sd">        Made a property so that it can be easily updated when any packages</span>
<span class="sd">        it depends on change.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idomain</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;DIS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_package_list</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_idomain</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idomain</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_idomain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remake the idomain array from the source data,</span>
<span class="sd">        no data values in the top and bottom arrays, and</span>
<span class="sd">        so that cells above SFR reaches are inactive.</span>

<span class="sd">        Also remakes irch for the recharge package&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(re)setting the idomain array...&#39;</span><span class="p">)</span>
        <span class="c1"># loop thru LGR models and inactivate area of parent grid for each one</span>
        <span class="n">lgr_idomain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">idomain</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lgr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lgr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">lgr_idomain</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">idomain</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lgr_idomain2d</span> <span class="o">=</span> <span class="n">lgr_idomain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">idomain_from_layer_elevations</span> <span class="o">=</span> <span class="n">make_idomain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">botm</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                                                     <span class="n">nodata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodata_value</span><span class="p">,</span>
                                                     <span class="n">minimum_layer_thickness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minimum_layer_thickness&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                                     <span class="n">drop_thin_cells</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_drop_thin_cells</span><span class="p">,</span>
                                                     <span class="n">tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
        <span class="c1"># include cells that are active in the existing idomain array</span>
        <span class="c1"># and cells inactivated on the basis of layer elevations</span>
        <span class="n">idomain</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">idomain</span><span class="o">.</span><span class="n">array</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> \
                  <span class="p">(</span><span class="n">idomain_from_layer_elevations</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> \
                  <span class="p">(</span><span class="n">lgr_idomain</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">idomain</span> <span class="o">=</span> <span class="n">idomain</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># remove cells that conincide with lakes</span>
        <span class="c1"># idomain[self.isbc == 1] = 0.</span>

        <span class="c1"># remove cells that are above stream cells</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_package</span><span class="p">(</span><span class="s1">&#39;sfr&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idomain</span> <span class="o">=</span> <span class="n">deactivate_idomain_above</span><span class="p">(</span><span class="n">idomain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr</span><span class="o">.</span><span class="n">packagedata</span><span class="p">)</span>

        <span class="c1"># inactivate any isolated cells that could cause problems with the solution</span>
        <span class="n">idomain</span> <span class="o">=</span> <span class="n">find_remove_isolated_cells</span><span class="p">(</span><span class="n">idomain</span><span class="p">,</span> <span class="n">minimum_cluster_size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="c1"># create pass-through cells in inactive cells that have an active cell above and below</span>
        <span class="c1"># by setting these cells to -1</span>
        <span class="n">idomain</span> <span class="o">=</span> <span class="n">create_vertical_pass_through_cells</span><span class="p">(</span><span class="n">idomain</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_idomain</span> <span class="o">=</span> <span class="n">idomain</span>

        <span class="c1"># take the updated idomain array and set cells != 1 to np.nan in layer botm array</span>
        <span class="c1"># including lake cells</span>
        <span class="c1"># effect is that the layer thicknesses in these cells will be set to zero</span>
        <span class="c1"># fill_cells_vertically will be run in the setup_array routine,</span>
        <span class="c1"># to collapse the nan cells to zero-thickness</span>
        <span class="c1"># (assign their layer botm to the next valid layer botm above)</span>
        <span class="n">botm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">botm</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">botm</span><span class="p">[(</span><span class="n">idomain</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="c1"># re-write the input files</span>
        <span class="c1"># todo: integrate this better with setup_dis</span>
        <span class="c1"># to reduce the number of times the arrays need to be remade</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="s1">&#39;dis&#39;</span><span class="p">,</span> <span class="s1">&#39;botm&#39;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">arr</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">botm</span><span class="p">)},</span>
                        <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array3d&#39;</span><span class="p">,</span> <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                        <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">botm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;griddata&#39;</span><span class="p">][</span><span class="s1">&#39;botm&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="s1">&#39;dis&#39;</span><span class="p">,</span> <span class="s1">&#39;idomain&#39;</span><span class="p">,</span>
                          <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">arr</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idomain</span><span class="p">)},</span>
                          <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array3d&#39;</span><span class="p">,</span> <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                          <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">idomain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;griddata&#39;</span><span class="p">][</span><span class="s1">&#39;idomain&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mg_resync</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_grid</span><span class="p">()</span>  <span class="c1"># reset the model grid</span>

        <span class="c1"># rebuild irch to keep it in sync with idomain changes</span>
        <span class="n">irch</span> <span class="o">=</span> <span class="n">make_irch</span><span class="p">(</span><span class="n">idomain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="s1">&#39;rch&#39;</span><span class="p">,</span> <span class="s1">&#39;irch&#39;</span><span class="p">,</span>
                                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">irch</span><span class="p">},</span>
                                <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array2d&#39;</span><span class="p">,</span>
                                <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1">#self.dis.irch = self.cfg[&#39;dis&#39;][&#39;irch&#39;]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_grid_configuration_with_dis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update grid configuration with any information supplied to dis package</span>
<span class="sd">        (so that settings specified for DIS package have priority). This method</span>
<span class="sd">        is called by MFsetupMixin.setup_grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nlay&#39;</span><span class="p">,</span> <span class="s1">&#39;nrow&#39;</span><span class="p">,</span> <span class="s1">&#39;ncol&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;setup_grid&#39;</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;dimensions&#39;</span><span class="p">][</span><span class="n">param</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;delr&#39;</span><span class="p">,</span> <span class="s1">&#39;delc&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;griddata&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;setup_grid&#39;</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;griddata&#39;</span><span class="p">][</span><span class="n">param</span><span class="p">]</span>

<div class="viewcode-block" id="MF6model.get_flopy_external_file_input">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.get_flopy_external_file_input">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_flopy_external_file_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Repath intermediate external file input to the</span>
<span class="sd">        external file path that MODFLOW will use. Copy the</span>
<span class="sd">        file because MF6 flopy reads and writes to the same location.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var : str</span>
<span class="sd">            key in self.cfg[&#39;intermediate_data&#39;] dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        input : dict or list of dicts</span>
<span class="sd">            MODFLOW6 external file input format</span>
<span class="sd">            {&#39;filename&#39;: &lt;filename&gt;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

        <span class="c1">#intermediate_paths = self.cfg[&#39;intermediate_data&#39;][var]</span>
        <span class="c1">#if isinstance(intermediate_paths, str):</span>
        <span class="c1">#    intermediate_paths = [intermediate_paths]</span>
        <span class="c1">#external_path = os.path.basename(os.path.normpath(self.external_path))</span>
        <span class="c1">#input = []</span>
        <span class="c1">#for f in intermediate_paths:</span>
        <span class="c1">#    outf = os.path.join(external_path, os.path.split(f)[1])</span>
        <span class="c1">#    input.append({&#39;filename&#39;: outf})</span>
        <span class="c1">#    shutil.copy(f, os.path.normpath(self.external_path))</span>
        <span class="c1">#if len(input) == 1:</span>
        <span class="c1">#    input = input[0]</span>
        <span class="c1">#return input</span>

<div class="viewcode-block" id="MF6model.get_package_list">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.get_package_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_package_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replicate this method in flopy.modflow.Modflow.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: this should reference namfile dict</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packagelist</span><span class="p">]</span></div>


<div class="viewcode-block" id="MF6model.get_raster_values_at_cell_centers">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.get_raster_values_at_cell_centers">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_raster_values_at_cell_centers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">out_of_bounds_errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample raster values at centroids</span>
<span class="sd">        of model grid cells.&quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">get_values_at_points</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span>
                                      <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modelgrid</span><span class="o">.</span><span class="n">xcellcenters</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                                      <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modelgrid</span><span class="o">.</span><span class="n">ycellcenters</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                                      <span class="n">points_crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modelgrid</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                                      <span class="n">out_of_bounds_errors</span><span class="o">=</span><span class="n">out_of_bounds_errors</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelgrid</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s1">&#39;structured&#39;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="MF6model.get_raster_statistics_for_cells">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.get_raster_statistics_for_cells">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_raster_statistics_for_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute zonal statics for raster pixels within</span>
<span class="sd">        each model cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">create_lgr_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;setup_grid&#39;</span><span class="p">][</span><span class="s1">&#39;lgr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># load the config file for lgr inset model</span>
            <span class="k">if</span> <span class="s1">&#39;filename&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">inset_cfg</span> <span class="o">=</span> <span class="n">load_cfg</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span>
                                    <span class="n">default_file</span><span class="o">=</span><span class="s1">&#39;mf6_defaults.yml&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;cfg&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">inset_cfg</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;cfg&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unrecognized input in subblock lgr: &#39;</span>
                                 <span class="s1">&#39;Supply either a configuration filename: &#39;</span>
                                 <span class="s1">&#39;or additional yaml configuration under cfg:&#39;</span>
                                 <span class="p">)</span>
            <span class="c1"># if lgr inset has already been created</span>
            <span class="k">if</span> <span class="n">inset_cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;modelname&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">_models</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">inset_cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span>
            <span class="k">if</span> <span class="s1">&#39;ims&#39;</span> <span class="ow">in</span> <span class="n">inset_cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;packages&#39;</span><span class="p">]:</span>
                <span class="n">inset_cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;packages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;ims&#39;</span><span class="p">)</span>
            <span class="c1"># set parent configuation dictionary here</span>
            <span class="c1"># (even though parent model is explicitly set below)</span>
            <span class="c1"># so that the LGR grid is snapped to the parent grid</span>
            <span class="n">inset_cfg</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;namefile&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">namefile</span><span class="p">,</span>
                                   <span class="s1">&#39;model_ws&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_ws</span><span class="p">,</span>
                                   <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;mf6&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;hiKlakes_value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;hiKlakes_value&#39;</span><span class="p">],</span>
                                   <span class="s1">&#39;default_source_data&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                   <span class="s1">&#39;length_units&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_units</span><span class="p">,</span>
                                   <span class="s1">&#39;time_units&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_units</span>
                                   <span class="p">}</span>
            <span class="n">inset_cfg</span> <span class="o">=</span> <span class="n">MF6model</span><span class="o">.</span><span class="n">_parse_model_kwargs</span><span class="p">(</span><span class="n">inset_cfg</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">inset_cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwf</span><span class="p">,</span>
                                         <span class="n">exclude</span><span class="o">=</span><span class="s1">&#39;packages&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># otherwise will try to load parent model</span>
            <span class="n">inset_model</span> <span class="o">=</span> <span class="n">MF6model</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">inset_cfg</span><span class="p">,</span> <span class="n">lgr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1">#inset_model._load = self._load  # whether model is being made or loaded from existing files</span>
            <span class="n">inset_model</span><span class="o">.</span><span class="n">setup_grid</span><span class="p">()</span>
            <span class="k">del</span> <span class="n">inset_model</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;ims&#39;</span><span class="p">]</span>
            <span class="n">inset_model</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inset</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lgr</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">inset</span><span class="p">[</span><span class="n">inset_model</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">inset_model</span>
            <span class="c1">#self.inset[inset_model.name]._is_lgr = True</span>

            <span class="c1"># establish inset model layering within parent model</span>
            <span class="n">parent_start_layer</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent_start_layer&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1"># parent_end_layer is specified as the last zero-based</span>
            <span class="c1"># parent layer that includes LGR refinement (not as a slice end)</span>
            <span class="n">parent_end_layer</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent_end_layer&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlay</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># the layer refinement can be specified as an int, a list or a dict</span>
            <span class="n">ncppl_input</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;layer_refinement&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">ncppl_input</span><span class="p">):</span>
                <span class="n">ncppl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelgrid</span><span class="o">.</span><span class="n">nlay</span><span class="p">)</span>
                <span class="n">ncppl</span><span class="p">[</span><span class="n">parent_start_layer</span><span class="p">:</span><span class="n">parent_end_layer</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ncppl_input</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ncppl_input</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ncppl_input</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelgrid</span><span class="o">.</span><span class="n">nlay</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Configuration input: layer_refinement specified as&quot;</span>
                        <span class="s2">&quot;a list must include a value for every layer.&quot;</span>
                    <span class="p">)</span>
                <span class="n">ncppl</span> <span class="o">=</span> <span class="n">ncppl_input</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ncppl_input</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">ncppl</span> <span class="o">=</span> <span class="p">[</span><span class="n">ncppl_input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelgrid</span><span class="o">.</span><span class="n">nlay</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Configuration input: Unsupported input for &quot;</span>
                                 <span class="s2">&quot;layer_refinement: supply an int, list or dict.&quot;</span><span class="p">)</span>

            <span class="c1"># refined layers must be consecutive, starting from layer 1</span>
            <span class="n">is_refined</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ncppl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">last_refined_layer</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_refined</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">consecutive</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">is_refined</span><span class="p">)[:</span><span class="n">last_refined_layer</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">is_refined</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="ow">not</span> <span class="n">consecutive</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Configuration input: layer_refinement must &quot;</span>
                                 <span class="s2">&quot;include consecutive sequence of layers, &quot;</span>
                                 <span class="s2">&quot;starting with the top layer.&quot;</span><span class="p">)</span>
            <span class="c1"># check the specified DIS package input is consistent</span>
            <span class="c1"># with the specified layer_refinement</span>
            <span class="n">specified_nlay_dis</span> <span class="o">=</span> <span class="n">inset_cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nlay&#39;</span><span class="p">)</span>
            <span class="c1"># skip this check if nlay hasn&#39;t been entered into the configuration file yet</span>
            <span class="k">if</span> <span class="n">specified_nlay_dis</span> <span class="ow">and</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ncppl</span><span class="p">)</span> <span class="o">!=</span> <span class="n">specified_nlay_dis</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Configuration input: layer_refinement  of </span><span class="si">{</span><span class="n">ncppl</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;implies </span><span class="si">{</span><span class="n">is_refined</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> inset model layers.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">specified_nlay_dis</span><span class="si">}</span><span class="s2"> inset model layers specified in DIS package.&quot;</span><span class="p">)</span>
            <span class="c1"># mapping between parent and inset model layers</span>
            <span class="c1"># that is used for copying input from parent model</span>
            <span class="n">inset_parent_layer_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">inset_k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">parent_k</span><span class="p">,</span> <span class="n">n_inset_lay</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ncppl</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_inset_lay</span><span class="p">):</span>
                    <span class="n">inset_k</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">inset_parent_layer_mapping</span><span class="p">[</span><span class="n">inset_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_k</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inset</span><span class="p">[</span><span class="n">inset_model</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">][</span><span class="s1">&#39;inset_layer_mapping&#39;</span><span class="p">]</span> <span class="o">=</span>\
                <span class="n">inset_parent_layer_mapping</span>
            <span class="c1"># create idomain indicating area of parent grid that is LGR</span>
            <span class="n">lgr_idomain</span> <span class="o">=</span> <span class="n">make_lgr_idomain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelgrid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inset</span><span class="p">[</span><span class="n">inset_model</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">modelgrid</span><span class="p">,</span>
                                           <span class="n">ncppl</span><span class="p">)</span>

            <span class="c1"># inset model horizontal refinement from parent resolution</span>
            <span class="n">refinement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelgrid</span><span class="o">.</span><span class="n">delr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">inset</span><span class="p">[</span><span class="n">inset_model</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">modelgrid</span><span class="o">.</span><span class="n">delr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">refinement</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LGR inset model spacing must be a factor of the parent model spacing.&quot;</span><span class="p">)</span>
            <span class="n">ncpp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">refinement</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lgr</span><span class="p">[</span><span class="n">inset_model</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Lgr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">delr</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">delc</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">botm</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                                             <span class="n">lgr_idomain</span><span class="p">,</span> <span class="n">ncpp</span><span class="p">,</span> <span class="n">ncppl</span><span class="p">)</span>
            <span class="n">inset_model</span><span class="o">.</span><span class="n">_perioddata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perioddata</span>
            <span class="c1"># set parent model top in LGR area to bottom of LGR area</span>
            <span class="c1"># this is an initial draft;</span>
            <span class="c1"># bottom elevations are readjusted in sourcedata.py</span>
            <span class="c1"># when inset model DIS package botm array is set up</span>
            <span class="c1"># (set to mean of inset model bottom elevations</span>
            <span class="c1">#  within each parent cell)</span>
            <span class="c1"># number of layers in parent model with LGR</span>
            <span class="n">n_parent_lgr_layers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ncppl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">lgr_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lgr</span><span class="p">[</span><span class="n">inset_model</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">idomain</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">lgr_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">lgr</span><span class="p">[</span><span class="n">inset_model</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">botmp</span><span class="p">[</span><span class="n">n_parent_lgr_layers</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">lgr_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="c1"># set parent model layers in LGR area to zero-thickness</span>
            <span class="n">new_parent_botm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">botm</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_parent_lgr_layers</span><span class="p">):</span>
                <span class="n">new_parent_botm</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">lgr_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">lgr_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">botm</span> <span class="o">=</span> <span class="n">new_parent_botm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_top_botm_external_files</span><span class="p">()</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_update_top_botm_external_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the external files after assigning new elevations to the</span>
<span class="sd">        Discretization Package top and botm arrays; adjust idomain as needed.&quot;&quot;&quot;</span>
        <span class="c1"># reset the model top</span>
        <span class="c1"># (this step may not be needed if the &quot;original top&quot; functionality</span>
        <span class="c1"># is limited to cases where there is a lake package,</span>
        <span class="c1"># or if the &quot;original top&quot;/&quot;lake bathymetry&quot; functionality is eliminated</span>
        <span class="c1"># and we instead require the top to be pre-processed)</span>
        <span class="n">original_top_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">external_path</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;top_filename_fmt&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.original&quot;</span><span class="p">)</span>
        <span class="n">original_top_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="s1">&#39;dis&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
                            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">array</span><span class="p">},</span>
                <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array2d&#39;</span><span class="p">,</span> <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="c1"># _set_idomain() regerates external files for bottom array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_idomain</span><span class="p">()</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">setup_lgr_exchanges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">inset_name</span><span class="p">,</span> <span class="n">inset_model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inset</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># update cell information for computing any bottom exchanges</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lgr</span><span class="p">[</span><span class="n">inset_name</span><span class="p">]</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">inset_model</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">array</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lgr</span><span class="p">[</span><span class="n">inset_name</span><span class="p">]</span><span class="o">.</span><span class="n">botm</span> <span class="o">=</span> <span class="n">inset_model</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">botm</span><span class="o">.</span><span class="n">array</span>
            <span class="c1"># update only the layers of the parent model below the child model</span>
            <span class="n">parent_top_below_child</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lgr</span><span class="p">[</span><span class="n">inset_name</span><span class="p">]</span><span class="o">.</span><span class="n">ncppl</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lgr</span><span class="p">[</span><span class="n">inset_name</span><span class="p">]</span><span class="o">.</span><span class="n">botmp</span><span class="p">[</span><span class="n">parent_top_below_child</span><span class="p">:]</span> <span class="o">=</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">.</span><span class="n">botm</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">parent_top_below_child</span><span class="p">:]</span>

            <span class="c1"># get the exchange data</span>
            <span class="n">exchangelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lgr</span><span class="p">[</span><span class="n">inset_name</span><span class="p">]</span><span class="o">.</span><span class="n">get_exchange_data</span><span class="p">(</span><span class="n">angldegx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cdist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># make a dataframe for concise unpacking of cellids</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cellidm1&#39;</span><span class="p">,</span> <span class="s1">&#39;cellidm2&#39;</span><span class="p">,</span> <span class="s1">&#39;ihc&#39;</span><span class="p">,</span> <span class="s1">&#39;cl1&#39;</span><span class="p">,</span> <span class="s1">&#39;cl2&#39;</span><span class="p">,</span> <span class="s1">&#39;hwva&#39;</span><span class="p">,</span> <span class="s1">&#39;angldegx&#39;</span><span class="p">,</span> <span class="s1">&#39;cdist&#39;</span><span class="p">]</span>
            <span class="n">exchangedf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">exchangelist</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

            <span class="c1"># unpack the cellids and get their respective ibound values</span>
            <span class="n">k1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">j1</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">exchangedf</span><span class="p">[</span><span class="s1">&#39;cellidm1&#39;</span><span class="p">])</span>
            <span class="n">k2</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j2</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">exchangedf</span><span class="p">[</span><span class="s1">&#39;cellidm2&#39;</span><span class="p">])</span>
            <span class="c1"># limit connections to</span>
            <span class="n">active1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idomain</span><span class="p">[</span><span class="n">k1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">j1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span>

            <span class="n">active2</span> <span class="o">=</span> <span class="n">inset_model</span><span class="o">.</span><span class="n">idomain</span><span class="p">[</span><span class="n">k2</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span>

            <span class="c1"># screen out connections involving an inactive cell</span>
            <span class="n">active_connections</span> <span class="o">=</span> <span class="n">active1</span> <span class="o">&amp;</span> <span class="n">active2</span>
            <span class="n">nexg</span> <span class="o">=</span> <span class="n">active_connections</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">active_exchangelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exchangelist</span><span class="p">)</span> <span class="k">if</span> <span class="n">active_connections</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

            <span class="c1"># arguments to ModflowGwfgwf</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;exgtype&#39;</span><span class="p">:</span> <span class="s1">&#39;gwf6-gwf6&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;exgmnamea&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="s1">&#39;exgmnameb&#39;</span><span class="p">:</span> <span class="n">inset_name</span><span class="p">,</span>
                        <span class="s1">&#39;nexg&#39;</span><span class="p">:</span> <span class="n">nexg</span><span class="p">,</span>
                        <span class="s1">&#39;auxiliary&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;angldegx&#39;</span><span class="p">,</span> <span class="s1">&#39;cdist&#39;</span><span class="p">)],</span>
                        <span class="s1">&#39;exchangedata&#39;</span><span class="p">:</span> <span class="n">active_exchangelist</span>
                        <span class="p">}</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfgwf</span><span class="p">)</span>

            <span class="c1"># set up the exchange package</span>
            <span class="n">gwfgwf</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfgwf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># set up a Mover Package if needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_simulation_mover</span><span class="p">(</span><span class="n">gwfgwf</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">setup_dis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;dis&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up </span><span class="si">{}</span><span class="s1"> package...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># resample the top from the DEM</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;remake_top&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array2d&#39;</span><span class="p">,</span>
                              <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                              <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># make the botm array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s1">&#39;botm&#39;</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array3d&#39;</span><span class="p">,</span>
                          <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                          <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># set number of layers to length of the created bottom array</span>
        <span class="c1"># this needs to be set prior to setting up the idomain,</span>
        <span class="c1"># otherwise idomain may have wrong number of layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;dimensions&#39;</span><span class="p">][</span><span class="s1">&#39;nlay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;griddata&#39;</span><span class="p">][</span><span class="s1">&#39;botm&#39;</span><span class="p">])</span>

        <span class="c1"># initial idomain input for creating a dis package instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s1">&#39;idomain&#39;</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array3d&#39;</span><span class="p">,</span> <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                          <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># put together keyword arguments for dis package</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># nrow, ncol, delr, delc</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;dimensions&#39;</span><span class="p">])</span> <span class="c1"># nper, nlay, etc.</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="s1">&#39;griddata&#39;</span><span class="p">])</span>

        <span class="c1"># modelgrid: dis arguments</span>
        <span class="n">remaps</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xoff&#39;</span><span class="p">:</span> <span class="s1">&#39;xorigin&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;yoff&#39;</span><span class="p">:</span> <span class="s1">&#39;yorigin&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;rotation&#39;</span><span class="p">:</span> <span class="s1">&#39;angrot&#39;</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">remaps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;length_units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_units</span>
        <span class="c1"># get the arguments for the flopy version of ModflowGwfdis</span>
        <span class="c1"># but instantiate with modflow-setup subclass of ModflowGwfdis</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfdis</span><span class="p">)</span>
        <span class="n">dis</span> <span class="o">=</span> <span class="n">ModflowGwfdis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mg_resync</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_bc_arrays</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_idomain</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dis</span>

    <span class="c1">#def setup_tdis(self):</span>
<div class="viewcode-block" id="MF6model.setup_tdis">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_tdis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_tdis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the TDIS package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;tdis&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up </span><span class="si">{}</span><span class="s1"> package...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">perioddata</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowTdis</span><span class="o">.</span><span class="n">perioddata</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nper</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;perlen&#39;</span><span class="p">,</span> <span class="s1">&#39;nstp&#39;</span><span class="p">,</span> <span class="s1">&#39;tsmult&#39;</span><span class="p">]:</span>
            <span class="n">perioddata</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perioddata</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;tdis&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nper&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nper</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;perioddata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">perioddata</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowTdis</span><span class="p">)</span>
        <span class="n">tdis</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowTdis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tdis</span></div>


<div class="viewcode-block" id="MF6model.setup_ic">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_ic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the IC package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;ic&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up </span><span class="si">{}</span><span class="s1"> package...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;griddata&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;source_data_config&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;source_data&#39;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;filename_fmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;strt_filename_fmt&#39;</span><span class="p">]</span>

        <span class="c1"># make the starting heads array</span>
        <span class="n">strt</span> <span class="o">=</span> <span class="n">setup_strt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ic</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strt</span><span class="o">=</span><span class="n">strt</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ic</span></div>


<div class="viewcode-block" id="MF6model.setup_npf">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_npf">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_npf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the NPF package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;npf&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up </span><span class="si">{}</span><span class="s1"> package...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">hiKlakes_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hiKlakes_value&#39;</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">))</span>

        <span class="c1"># make the k array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">hiKlakes_value</span><span class="p">,</span>
                          <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                          <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array3d&#39;</span><span class="p">,</span> <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.6e</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># make the k33 array (kv)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s1">&#39;k33&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">hiKlakes_value</span><span class="p">,</span>
                          <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                          <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array3d&#39;</span><span class="p">,</span> <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.6e</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;griddata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfnpf</span><span class="p">)</span>
        <span class="n">npf</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfnpf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">npf</span></div>


<div class="viewcode-block" id="MF6model.setup_sto">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_sto">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_sto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the STO package.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">perioddata</span><span class="p">[</span><span class="s1">&#39;steady&#39;</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skipping STO package, no transient stress periods...&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;sto&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up </span><span class="si">{}</span><span class="s1"> package...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># make the sy array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s1">&#39;sy&#39;</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array3d&#39;</span><span class="p">,</span> <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                          <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.6e</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># make the ss array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s1">&#39;ss&#39;</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array3d&#39;</span><span class="p">,</span> <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                          <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.6e</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;griddata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="c1"># get steady/transient info from perioddata table</span>
        <span class="c1"># which parses it from either DIS or STO input (to allow consistent input structure with mf2005)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;steady_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">perioddata</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">perioddata</span><span class="p">[</span><span class="s1">&#39;steady&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;transient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="ow">not</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">perioddata</span><span class="p">[</span><span class="s1">&#39;per&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">perioddata</span><span class="p">[</span><span class="s1">&#39;steady&#39;</span><span class="p">])}</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfsto</span><span class="p">)</span>
        <span class="n">sto</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfsto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">sto</span></div>


<div class="viewcode-block" id="MF6model.setup_rch">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_rch">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_rch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the RCH package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;rch&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up </span><span class="si">{}</span><span class="s1"> package...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># make the irch array</span>
        <span class="n">irch</span> <span class="o">=</span> <span class="n">make_irch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idomain</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="s1">&#39;rch&#39;</span><span class="p">,</span> <span class="s1">&#39;irch&#39;</span><span class="p">,</span>
                          <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">irch</span><span class="p">},</span>
                          <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;array2d&#39;</span><span class="p">,</span>
                          <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># make the rech array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_array</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s1">&#39;recharge&#39;</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;transient2d&#39;</span><span class="p">,</span>
                          <span class="n">resample_method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">write_fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.6e</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">write_nodata</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfrcha</span><span class="p">)</span>
        <span class="n">rch</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfrcha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rch</span></div>


<div class="viewcode-block" id="MF6model.setup_lak">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_lak">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_lak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the Lake package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;lak&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up </span><span class="si">{}</span><span class="s1"> package...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lakarr</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lakes_shapefile not specified, or no lakes in model area&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># option to write connectiondata to external file</span>
        <span class="n">external_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;lak&#39;</span><span class="p">][</span><span class="s1">&#39;external_files&#39;</span><span class="p">]</span>
        <span class="n">horizontal_connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;lak&#39;</span><span class="p">][</span><span class="s1">&#39;horizontal_connections&#39;</span><span class="p">]</span>


        <span class="c1"># source data</span>
        <span class="n">source_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;lak&#39;</span><span class="p">][</span><span class="s1">&#39;source_data&#39;</span><span class="p">]</span>

        <span class="c1"># munge lake package input</span>
        <span class="c1"># returns dataframe with information for each lake</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lake_info</span> <span class="o">=</span> <span class="n">setup_lake_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># returns dataframe with connection information</span>
        <span class="n">connectiondata</span> <span class="o">=</span> <span class="n">setup_lake_connectiondata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_external_file</span><span class="o">=</span><span class="n">external_files</span><span class="p">,</span>
                                                   <span class="n">include_horizontal_connections</span><span class="o">=</span><span class="n">horizontal_connections</span><span class="p">)</span>
        <span class="c1"># lakeno column will have # in front if for_external_file=True</span>
        <span class="n">lakeno_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">connectiondata</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;lakeno&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nlakeconn</span> <span class="o">=</span> <span class="n">connectiondata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">lakeno_col</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">iconn</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">external_files</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lake_info</span><span class="p">[</span><span class="s1">&#39;nlakeconn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nlakeconn</span><span class="p">[</span><span class="nb">id</span> <span class="o">-</span> <span class="n">offset</span><span class="p">]</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lake_info</span><span class="p">[</span><span class="s1">&#39;lak_id&#39;</span><span class="p">]]</span>

        <span class="c1"># set up the tab files</span>
        <span class="k">if</span> <span class="s1">&#39;stage_area_volume_file&#39;</span> <span class="ow">in</span> <span class="n">source_data</span><span class="p">:</span>
            <span class="n">tab_files</span> <span class="o">=</span> <span class="n">setup_lake_tablefiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_data</span><span class="p">[</span><span class="s1">&#39;stage_area_volume_file&#39;</span><span class="p">])</span>

            <span class="c1"># tabfiles aren&#39;t rewritten by flopy on package write</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;lak&#39;</span><span class="p">][</span><span class="s1">&#39;tab_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab_files</span>
            <span class="c1"># kludge to deal with ugliness of lake package external file handling</span>
            <span class="c1"># (need to give path relative to model_ws, not folder that flopy is working in)</span>
            <span class="n">tab_files_argument</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">tab_files</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tab_files</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># todo: implement lake outlets with SFR</span>

        <span class="c1"># perioddata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lake_fluxes</span> <span class="o">=</span> <span class="n">setup_lake_fluxes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">lakeperioddata</span> <span class="o">=</span> <span class="n">get_lakeperioddata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lake_fluxes</span><span class="p">)</span>

        <span class="c1"># set up external files</span>
        <span class="n">connectiondata_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">lakeno_col</span><span class="p">,</span> <span class="s1">&#39;iconn&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="s1">&#39;claktype&#39;</span><span class="p">,</span> <span class="s1">&#39;bedleak&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;belev&#39;</span><span class="p">,</span> <span class="s1">&#39;telev&#39;</span><span class="p">,</span> <span class="s1">&#39;connlen&#39;</span><span class="p">,</span> <span class="s1">&#39;connwidth&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">external_files</span><span class="p">:</span>
            <span class="c1"># get the file path (allowing for different external file locations, specified name format, etc.)</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_external_filepaths</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s1">&#39;connectiondata&#39;</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;connectiondata_filename_fmt&#39;</span><span class="p">])</span>
            <span class="n">connectiondata</span><span class="p">[</span><span class="n">connectiondata_cols</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="c1"># make a copy for the intermediate data folder, for consistency with mf-2005</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">filepath</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;intermediate_data&#39;</span><span class="p">][</span><span class="s1">&#39;output_folder&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">connectiondata_cols</span> <span class="o">=</span> <span class="n">connectiondata_cols</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;cellid&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">connectiondata_cols</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;connectiondata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">connectiondata</span><span class="p">[</span><span class="n">connectiondata_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># set up input arguments</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">renames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;budget_fileout&#39;</span><span class="p">:</span> <span class="s1">&#39;budget_filerecord&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;stage_fileout&#39;</span><span class="p">:</span> <span class="s1">&#39;stage_filerecord&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">renames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">options</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time_conversion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_time_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_units</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;length_conversion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_time_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length_units</span><span class="p">,</span> <span class="s1">&#39;meters&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nlakes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lake_info</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;noutlets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># not implemented</span>
        <span class="c1"># [lakeno, strt, nlakeconn, aux, boundname]</span>
        <span class="n">packagedata_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lak_id&#39;</span><span class="p">,</span> <span class="s1">&#39;strt&#39;</span><span class="p">,</span> <span class="s1">&#39;nlakeconn&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;boundnames&#39;</span><span class="p">):</span>
            <span class="n">packagedata_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">packagedata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lake_info</span><span class="p">[</span><span class="n">packagedata_cols</span><span class="p">]</span>
        <span class="n">packagedata</span><span class="p">[</span><span class="s1">&#39;lak_id&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>  <span class="c1"># convert to zero-based</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;packagedata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">packagedata</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span>  <span class="n">tab_files</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ntables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab_files</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>  <span class="c1">#, &#39;junk&#39;, &#39;junk&#39;)</span>
                                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tab_files</span><span class="p">)]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;outlets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># not implemented</span>
        <span class="c1">#kwargs[&#39;outletperioddata&#39;] = None  # not implemented</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;perioddata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lakeperioddata</span>

        <span class="c1"># observations</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;observations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">setup_mf6_lake_obs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwflak</span><span class="p">)</span>
        <span class="n">lak</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwflak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lak</span></div>



<div class="viewcode-block" id="MF6model.setup_chd">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_chd">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_chd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the CHD Package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_basic_stress_package</span><span class="p">(</span>
            <span class="s1">&#39;chd&#39;</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfchd</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;head&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="MF6model.setup_drn">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_drn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_drn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the Drain Package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_basic_stress_package</span><span class="p">(</span>
            <span class="s1">&#39;drn&#39;</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfdrn</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;elev&#39;</span><span class="p">,</span> <span class="s1">&#39;cond&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="MF6model.setup_ghb">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_ghb">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ghb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the General Head Boundary Package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_basic_stress_package</span><span class="p">(</span>
            <span class="s1">&#39;ghb&#39;</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfghb</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bhead&#39;</span><span class="p">,</span> <span class="s1">&#39;cond&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="MF6model.setup_riv">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_riv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_riv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rivdata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the River Package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_basic_stress_package</span><span class="p">(</span>
            <span class="s1">&#39;riv&#39;</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfriv</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">,</span> <span class="s1">&#39;cond&#39;</span><span class="p">,</span> <span class="s1">&#39;rbot&#39;</span><span class="p">],</span>
            <span class="n">rivdata</span><span class="o">=</span><span class="n">rivdata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="MF6model.setup_wel">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_wel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_wel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the Well Package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_basic_stress_package</span><span class="p">(</span>
            <span class="s1">&#39;wel&#39;</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfwel</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="MF6model.setup_obs">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_obs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the OBS utility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;obs&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up </span><span class="si">{}</span><span class="s1"> package...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">iobs_domain</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mfsetup_options&#39;</span><span class="p">][</span><span class="s1">&#39;allow_obs_in_bc_cells&#39;</span><span class="p">]:</span>
            <span class="c1"># for now, discard any head observations in same (i, j) column of cells</span>
            <span class="c1"># as a non-well boundary condition</span>
            <span class="c1"># including lake package lakes and non lake, non well BCs</span>
            <span class="c1"># (high-K lakes are excluded, since we may want head obs at those locations,</span>
            <span class="c1">#  to serve as pseudo lake stage observations)</span>
            <span class="n">iobs_domain</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">isbc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isbc</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="c1"># munge the observation data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">setup_head_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">obs_package</span><span class="o">=</span><span class="n">package</span><span class="p">,</span>
                                     <span class="n">obsname_column</span><span class="o">=</span><span class="s1">&#39;obsname&#39;</span><span class="p">,</span>
                                     <span class="n">iobs_domain</span><span class="o">=</span><span class="n">iobs_domain</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;source_data&#39;</span><span class="p">],</span>
                                     <span class="o">**</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mfsetup_options&#39;</span><span class="p">])</span>

        <span class="c1"># reformat to flopy input format</span>
        <span class="n">obsdata</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;obsname&#39;</span><span class="p">,</span> <span class="s1">&#39;obstype&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;mfsetup_options&#39;</span><span class="p">][</span><span class="s1">&#39;filename_fmt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">obsdata</span> <span class="o">=</span> <span class="p">{</span><span class="n">filename</span><span class="p">:</span> <span class="n">obsdata</span><span class="p">}</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">])</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;continuous&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obsdata</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowUtlobs</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowUtlobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">obs</span></div>


<div class="viewcode-block" id="MF6model.setup_oc">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_oc">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_oc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the OC package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;oc&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up </span><span class="si">{}</span><span class="s1"> package...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;budget_filerecord&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;budget_fileout_fmt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;head_filerecord&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">][</span><span class="s1">&#39;head_fileout_fmt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">period_input</span> <span class="o">=</span> <span class="n">parse_oc_period_input</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">period_input</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfoc</span><span class="p">)</span>
        <span class="n">oc</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">oc</span></div>


<div class="viewcode-block" id="MF6model.setup_ims">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_ims">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the IMS package.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;ims&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up </span><span class="si">{}</span><span class="s1"> package...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">])</span>
        <span class="c1"># renames to cover difference between mf6: flopy input</span>
        <span class="n">renames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;csv_outer_output&#39;</span><span class="p">:</span> <span class="s1">&#39;csv_outer_output_filerecord&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;csv_inner_output&#39;</span><span class="p">:</span> <span class="s1">&#39;csv_outer_inner_filerecord&#39;</span>
                   <span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">renames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowIms</span><span class="p">)</span>
        <span class="n">ims</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowIms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1">#self.simulation.register_ims_package(ims, [self.name])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ims</span></div>


<div class="viewcode-block" id="MF6model.setup_simulation_mover">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.setup_simulation_mover">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_simulation_mover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gwfgwf</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up the MODFLOW-6 water mover package at the simulation level.</span>
<span class="sd">        Automate set-up of the mover between SFR packages in LGR parent and inset models.</span>
<span class="sd">        todo: automate set-up of mover between SFR and lakes (within a model).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gwfgwf : Flopy :class:`~flopy.mf6.modflow.mfgwfgwf.ModflowGwfgwf` package instance</span>

<span class="sd">        Notes</span>
<span class="sd">        ------</span>
<span class="sd">        Other uses of the water mover need to be configured manually using flopy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">package</span> <span class="o">=</span> <span class="s1">&#39;mvr&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Setting up the simulation water mover package...&#39;</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">perioddata_dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_package</span><span class="p">(</span><span class="s1">&#39;sfr&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">inset_name</span><span class="p">,</span> <span class="n">inset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inset</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">inset</span><span class="o">.</span><span class="n">get_package</span><span class="p">(</span><span class="s1">&#39;sfr&#39;</span><span class="p">):</span>
                        <span class="n">inset_perioddata</span> <span class="o">=</span> <span class="n">get_mover_sfr_package_input</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">,</span> <span class="n">inset</span><span class="p">,</span> <span class="n">gwfgwf</span><span class="o">.</span><span class="n">exchangedata</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                        <span class="n">perioddata_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inset_perioddata</span><span class="p">)</span>
                        <span class="c1"># for each SFR reach with a connection</span>
                        <span class="c1"># to a reach in another model</span>
                        <span class="c1"># set the SFR Package downstream connection to 0</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">inset_perioddata</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                            <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;mname1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sfrdata</span><span class="o">.</span><span class="n">reach_data</span>
                            <span class="n">rd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;rno&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;id1&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;outreach&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="c1"># fix flopy connectiondata as well</span>
                            <span class="n">sfr_package</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;mname1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sfr</span>
                            <span class="n">cd</span> <span class="o">=</span> <span class="n">sfr_package</span><span class="o">.</span><span class="n">connectiondata</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                            <span class="c1"># there should be no downstream reaches</span>
                            <span class="c1"># (indicated by negative numbers)</span>
                            <span class="n">cd</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;id1&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cd</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;id1&#39;</span><span class="p">]]</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="n">sfr_package</span><span class="o">.</span><span class="n">connectiondata</span> <span class="o">=</span> <span class="n">cd</span>
                        <span class="c1"># re-write the shapefile exports with corrected routing</span>
                        <span class="n">inset</span><span class="o">.</span><span class="n">sfrdata</span><span class="o">.</span><span class="n">write_shapefiles</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">inset</span><span class="o">.</span><span class="n">_shapefiles_path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">inset_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sfrdata</span><span class="o">.</span><span class="n">write_shapefiles</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_shapefiles_path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">perioddata_dfs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">perioddata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">perioddata_dfs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">perioddata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">package</span><span class="p">])</span>
                <span class="c1"># modelnames (boolean) keyword to indicate that all package names will</span>
                <span class="c1"># be preceded by the model name for the package. Model names are</span>
                <span class="c1"># required when the Mover Package is used with a GWF-GWF Exchange. The</span>
                <span class="c1"># MODELNAME keyword should not be used for a Mover Package that is for</span>
                <span class="c1"># a single GWF Model.</span>
                <span class="c1"># this argument will need to be adapted for implementing a mover package within a model</span>
                <span class="c1"># (between lakes and sfr)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;modelnames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maxmvr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">perioddata</span><span class="p">)</span>  <span class="c1"># assumes that input for period 0 applies to all periods</span>
                <span class="n">packages</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">perioddata</span><span class="o">.</span><span class="n">mname1</span><span class="p">,</span> <span class="n">perioddata</span><span class="o">.</span><span class="n">pname1</span><span class="p">))</span> <span class="o">+</span>
                               <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">perioddata</span><span class="o">.</span><span class="n">mname2</span><span class="p">,</span> <span class="n">perioddata</span><span class="o">.</span><span class="n">pname2</span><span class="p">)))</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maxpackages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;perioddata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">perioddata</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>  <span class="c1"># assumes that input for period 0 applies to all periods</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowGwfmvr</span><span class="p">)</span>
                <span class="n">mvr</span> <span class="o">=</span> <span class="n">mf6</span><span class="o">.</span><span class="n">ModflowMvr</span><span class="p">(</span><span class="n">gwfgwf</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished in </span><span class="si">{:.2f}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">mvr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no packages with mover information</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MF6model.write_input">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.write_input">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the model input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># prior to writing output</span>
        <span class="c1"># remove any BCs in inactive cells</span>
        <span class="c1"># handle cases of single model or multi-model LGR simulation</span>
        <span class="c1"># by working with the simulation-level model dictionary</span>
        <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">model_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">pckgs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chd&#39;</span><span class="p">,</span> <span class="s1">&#39;drn&#39;</span><span class="p">,</span> <span class="s1">&#39;ghb&#39;</span><span class="p">,</span> <span class="s1">&#39;riv&#39;</span><span class="p">,</span> <span class="s1">&#39;wel&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pckg</span> <span class="ow">in</span> <span class="n">pckgs</span><span class="p">:</span>
                <span class="n">package_instance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">pckg</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">package_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">external_files</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="n">pckg</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="s1">&#39;stress_period_data&#39;</span><span class="p">]</span>
                    <span class="n">remove_inactive_bcs</span><span class="p">(</span><span class="n">package_instance</span><span class="p">,</span>
                                        <span class="n">external_files</span><span class="o">=</span><span class="n">external_files</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;obs&#39;</span><span class="p">):</span>
                <span class="c1"># handle case of single obs package, in which case model.obs</span>
                <span class="c1"># will be a ModflowUtlobs package instance</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">obs</span><span class="p">)</span>
                    <span class="n">obs_packages</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">obs</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">obs_packages</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">obs</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">obs_package_instance</span> <span class="ow">in</span> <span class="n">obs_packages</span><span class="p">:</span>
                    <span class="n">remove_inactive_obs</span><span class="p">(</span><span class="n">obs_package_instance</span><span class="p">)</span>

            <span class="c1"># write the model with flopy</span>
            <span class="c1"># but skip the sfr package</span>
            <span class="c1"># by monkey-patching the write method</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">skip_write</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;sfr&#39;</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">sfr</span><span class="o">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">skip_write</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">write_simulation</span><span class="p">()</span>

        <span class="c1"># post-flopy write actions</span>
        <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">model_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># write the sfr package with SFRmaker</span>
            <span class="k">if</span> <span class="s1">&#39;SFR&#39;</span> <span class="ow">in</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">get_package_list</span><span class="p">()):</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;sfr&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;save_flows&#39;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                    <span class="n">budget_fileout</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span>
                                                    <span class="n">model</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;sfr&#39;</span><span class="p">][</span><span class="s1">&#39;budget_fileout&#39;</span><span class="p">])</span>
                    <span class="n">stage_fileout</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span>
                                                <span class="n">model</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;sfr&#39;</span><span class="p">][</span><span class="s1">&#39;stage_fileout&#39;</span><span class="p">])</span>
                    <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;budget fileout </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">budget_fileout</span><span class="p">))</span>
                    <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;stage fileout </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stage_fileout</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">sfrdata</span><span class="o">.</span><span class="n">observations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;obs6 filein </span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span>
                                                            <span class="n">model</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;sfr&#39;</span><span class="p">][</span><span class="s1">&#39;obs6_filein_fmt&#39;</span><span class="p">])</span>
                                <span class="p">)</span>
                <span class="n">model</span><span class="o">.</span><span class="n">sfrdata</span><span class="o">.</span><span class="n">write_package</span><span class="p">(</span><span class="n">idomain</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">idomain</span><span class="p">,</span>
                                        <span class="n">version</span><span class="o">=</span><span class="s1">&#39;mf6&#39;</span><span class="p">,</span>
                                        <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
                                        <span class="n">external_files_path</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">external_path</span>
                                        <span class="p">)</span>
            <span class="c1"># add version info to package file headers</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">namefile</span><span class="p">]</span>
            <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">filename</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">packagelist</span><span class="p">]</span>
            <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">package_key_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">add_version_to_fileheader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">model_info</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;mfsetup_options&#39;</span><span class="p">][</span><span class="s1">&#39;keep_original_arrays&#39;</span><span class="p">]:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">tmpdir</span><span class="p">)</span>

        <span class="c1"># label stress periods in tdis file with comments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">perioddata</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;per&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">add_date_comments_to_tdis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">tdis</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">perioddata</span><span class="o">.</span><span class="n">start_datetime</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">perioddata</span><span class="o">.</span><span class="n">end_datetime</span>
                                  <span class="p">)</span></div>




    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_model_kwargs</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># assume that simulation for model</span>
            <span class="c1"># is the one simulation specified in configuration</span>
            <span class="c1"># (regardless of the name specified in model configuration)</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;simulation&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># create simulation from simulation block in config dict</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;simulation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">])</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_input_arguments</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">mf6</span><span class="o">.</span><span class="n">MFSimulation</span><span class="p">)</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">mf6</span><span class="o">.</span><span class="n">MFSimulation</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim</span>
            <span class="n">sim_ws</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;sim_ws&#39;</span><span class="p">]</span>
        <span class="c1"># if a simulation has already been created, get the path from the instance</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">],</span> <span class="n">mf6</span><span class="o">.</span><span class="n">MFSimulation</span><span class="p">):</span>
            <span class="n">sim_ws</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">mfpath</span><span class="o">.</span><span class="n">_sim_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;unrecognized configuration input for simulation.&#39;</span><span class="p">)</span>

        <span class="c1"># listing file</span>
        <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;list_filename_fmt&#39;</span><span class="p">]</span>
                                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;modelname&#39;</span><span class="p">]))</span>

        <span class="c1"># newton options</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">][</span><span class="s1">&#39;newtonoptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;newton_under_relaxation&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">][</span><span class="s1">&#39;newtonoptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;under_relaxation&#39;</span><span class="p">]</span>
        <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cfg</span>


<div class="viewcode-block" id="MF6model.load_from_config">
<a class="viewcode-back" href="../../api/mfsetup.mf6model.html#mfsetup.mf6model.MF6model.load_from_config">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">yamlfile</span><span class="p">,</span> <span class="n">load_only</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a model from a configuration file and set of MODFLOW files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yamlfile : pathlike</span>
<span class="sd">            Modflow setup YAML format configuration file</span>
<span class="sd">        load_only : list</span>
<span class="sd">            List of package abbreviations or package names corresponding to</span>
<span class="sd">            packages that flopy will load. default is None, which loads all</span>
<span class="sd">            packages. the discretization packages will load regardless of this</span>
<span class="sd">            setting. subpackages, like time series and observations, will also</span>
<span class="sd">            load regardless of this setting.</span>
<span class="sd">            example list: [&#39;ic&#39;, &#39;maw&#39;, &#39;npf&#39;, &#39;oc&#39;, &#39;ims&#39;, &#39;gwf6-gwf6&#39;]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        m : mfsetup.MF6model instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Loading simulation in </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">))</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1">#cfg = load_cfg(yamlfile, verbose=verbose, default_file=cls.default_file) # &#39;mf6_defaults.yml&#39;)</span>
        <span class="c1">#cfg = cls._parse_model_kwargs(cfg)</span>
        <span class="c1">#kwargs = get_input_arguments(cfg[&#39;model&#39;], mf6.ModflowGwf,</span>
        <span class="c1">#                             exclude=&#39;packages&#39;)</span>
        <span class="c1">#model = cls(cfg=cfg, **kwargs)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">yamlfile</span><span class="p">,</span> <span class="n">load</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;grid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">model</span><span class="o">.</span><span class="n">setup_grid</span><span class="p">()</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">]</span>  <span class="c1"># should be a flopy.mf6.MFSimulation instance</span>
        <span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inset</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">inset_name</span><span class="p">,</span> <span class="n">inset</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">inset</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inset</span><span class="p">)</span>

        <span class="c1"># execute the flopy load code on the pre-defined simulation and model instances</span>
        <span class="c1"># (so that the end result is a MFsetup.MF6model instance)</span>
        <span class="c1"># (kludgy)</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">flopy_mfsimulation_load</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">load_only</span><span class="o">=</span><span class="n">load_only</span><span class="p">)</span>

        <span class="c1"># just return the parent model (inset models should be attached through the inset attribute,</span>
        <span class="c1"># in addition to through the .simulation flopy attribute)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;finished loading model in </span><span class="si">{:.2f}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">m</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2025, Modflow-setup developers |.
      <span class="lastupdated">Last updated on Mar 18, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>